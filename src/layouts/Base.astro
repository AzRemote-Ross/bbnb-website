---
import LanguageSwitcher from '../components/LanguageSwitcher';
import ThemeToggle from '../components/ThemeToggle';
import { getLangFromPath, t } from '../i18n';
// buildLocalBusinessJsonLd is used inside the HTML template; ESLint's parser does not detect that usage.
// Minimal inline JSON-LD builder to avoid unused import hint while keeping single source of truth.
import { buildLocalBusinessJsonLd } from '../lib/business'; // used inside JSON-LD script
import { buildCanonical, buildAlternateLinks } from '../lib/seo';
import "../styles/global.css";
const lang = getLangFromPath(Astro.url.pathname);
const copy = t(lang);
const site = new URL(import.meta.env?.SITE || Astro.site || 'http://localhost:4321');
const canonical = buildCanonical(site, Astro.url.pathname);
const alternates = buildAlternateLinks(site, Astro.url.pathname);
// JSON-LD will be built inline in the head for minimal footprint
---

<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{copy.siteName}</title>
  <script is:inline>(function(){try{var d=document.documentElement;var t=localStorage.getItem('theme');var m=window.matchMedia('(prefers-color-scheme: dark)').matches;var dark=t? t==='dark': m;d.classList.toggle('dark',dark);d.setAttribute('data-theme',dark?'dark':'light');}catch(_){/* Theme detection failed, continue without dark mode */}})();</script>
    <link rel="canonical" href={canonical} />
    {alternates.map(a => (
      <link rel="alternate" hreflang={a.hrefLang} href={a.href} />
    ))}
  <script is:inline type="application/ld+json">{JSON.stringify(buildLocalBusinessJsonLd(lang))}</script>
  </head>
  <body class="bg-white text-black dark:bg-neutral-950 dark:text-neutral-100">
    <header class="mx-auto flex max-w-6xl items-center justify-between p-4">
      <a href={lang === 'ja' ? '/ja/' : '/en/'} class="font-semibold">{copy.siteName}</a>
      <nav class="flex gap-3">
        <a href={`/${lang}/services/`} class="hover:underline">{copy.nav.services}</a>
        <a href={`/${lang}/contact`} class="hover:underline">{copy.nav.contact}</a>
        <LanguageSwitcher client:load current={lang} />
        <ThemeToggle client:load />
      </nav>
    </header>
    <main class="mx-auto max-w-6xl px-4">
      <slot />
    </main>
    <footer class="mx-auto max-w-6xl p-6 opacity-70">Â© {new Date().getFullYear()} {copy.siteName}</footer>
  </body>
</html>
